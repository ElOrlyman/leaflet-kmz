{"version":3,"file":"leaflet-kmz.js","sources":["../src/KMZParser.js","../src/KMZLoader.js","../src/GridLayer.GeoJSON.js"],"sourcesContent":["L.KMZParser = L.Class.extend({\r\n\r\n  initialize: function(opts) {\r\n    L.setOptions(this, opts);\r\n    this.loaders = [];\r\n  },\r\n\r\n  load: function(kmzUrl, opts) {\r\n    this._loadAsyncJS(); // async download all required JS modules.\r\n    this._waitAsyncJS(this._loadKMZ.bind(this, kmzUrl, opts)); // wait until all JS modules are downloaded.\r\n  },\r\n\r\n  get: function(i) {\r\n    return i < this.loaders.length ? this.loaders[i] : false;\r\n  },\r\n\r\n  _loadKMZ: function(kmzUrl, opts) {\r\n    var kmzLoader = new L.KMZLoader(L.extend({}, this.options, opts));\r\n    kmzLoader.parse(kmzUrl);\r\n    this.loaders.push(kmzLoader);\r\n  },\r\n\r\n  _loadAsyncJS: function() {\r\n    if (!this._jsPromise) {\r\n      var urls = [];\r\n      var host = 'https://unpkg.com/';\r\n\r\n      if (typeof JSZip !== 'function' && typeof window.JSZip !== 'function') {\r\n        urls.push(host + 'jszip@3.1.5/dist/jszip.min.js');\r\n      }\r\n      if (typeof toGeoJSON !== 'object' && typeof window.toGeoJSON !== 'object') {\r\n        urls.push(host + '@tmcw/togeojson@3.0.1/dist/togeojsons.min.js');\r\n      }\r\n      if (typeof geojsonvt !== 'function' && typeof window.geojsonvt !== 'function') {\r\n        urls.push(host + 'geojson-vt@3.0.0/geojson-vt.js');\r\n      }\r\n\r\n      if (urls.length) {\r\n        var promises = urls.map(url => this._loadJS(url));\r\n        this._jsPromisePending = true;\r\n        this._jsPromise = Promise.all(promises).then(function() {\r\n          this._jsPromisePending = false;\r\n        }.bind(this));\r\n      }\r\n    }\r\n  },\r\n\r\n  _loadJS: function(url) {\r\n    return new Promise(function(resolve, reject) {\r\n      var tag = document.createElement(\"script\");\r\n      tag.type = \"text/javascript\";\r\n      tag.src = url;\r\n      tag.onload = resolve.bind(url);\r\n      tag.onerror = reject.bind(url);\r\n      document.head.appendChild(tag);\r\n    });\r\n  },\r\n\r\n  _waitAsyncJS: function(callback) {\r\n    if (this._jsPromise && this._jsPromisePending) {\r\n      this._jsPromise.then(callback);\r\n    } else {\r\n      callback.call();\r\n    }\r\n  },\r\n\r\n});\r\n\r\nexport var KMZParser = L.KMZParser;\r\n","// import JSZip from 'jszip';\r\n// import geojsonvt from 'geojson-vt';\r\n// import * as toGeoJSON from '@tmcw/togeojson';\r\n\r\nL.KMZLoader = L.Class.extend({\r\n  options: {\r\n    tiled: true,\r\n    interactive: true,\r\n    ballon: true,\r\n    bindPopup: true,\r\n    bindTooltip: true,\r\n    debug: 0,\r\n  },\r\n\r\n  initialize: function(opts) {\r\n    L.setOptions(this, opts);\r\n\r\n    this.tiled = this.options.tiled; // (Optimized) GeoJSON Vector Tiles [\"geojson-vt.js\"] library.\r\n    this.interactive = this.options.interactive; // (Default) Mouse interactions through [\"leaflet.js\"] layers.\r\n    this.pointable = this.tiled && !this.interactive && this.options.pointable; // (Experimental) Optimized Mouse interactions through [\"geojson-vt.js\", \"leaflet-pointable.js\"] libraries.\r\n    this.emptyIcon = 'data:image/png;base64,' + \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAFElEQVR4XgXAAQ0AAABAMP1L30IDCPwC/o5WcS4AAAAASUVORK5CYII=\";\r\n    this.name = this.options.name;\r\n    this.callback = opts.onKMZLoaded;\r\n  },\r\n\r\n  parse: function(kmzUrl) {\r\n    this.name = this.name ? this.name : kmzUrl.split('/').pop();\r\n    this._load(kmzUrl);\r\n  },\r\n\r\n  _load: function(url) {\r\n    this._getBinaryContent(url, function(err, data) {\r\n      if (err != null) console.error(url, err, data);\r\n      else this._parse(data);\r\n    }.bind(this));\r\n  },\r\n\r\n  _parse: function(data) {\r\n    return this._isZipped(data) ? this._parseKMZ(data) : this._parseKML(data);\r\n  },\r\n\r\n  _parseKMZ: function(data) {\r\n    var that = this;\r\n    JSZip.loadAsync(data).then((zip) => {\r\n      Promise.all(that._mapZipFiles(zip)).then((list) => {\r\n        Promise.all(that._mapListFiles(list)).then((data) => {\r\n          var kmlString = this._decodeKMZFolder(data);\r\n          that._parseKML(kmlString);\r\n        });\r\n      });\r\n    });\r\n  },\r\n\r\n  _parseKML: function(data) {\r\n    var kmlString = this._decodeKMLString(data);\r\n    var xmlDoc = this._toXML(kmlString);\r\n    this._kmlToLayer(xmlDoc);\r\n  },\r\n\r\n  _decodeKMLString: function(data) {\r\n    return data instanceof ArrayBuffer ? String.fromCharCode.apply(null, new Uint8Array(data)) : data;\r\n  },\r\n\r\n  _decodeKMZFolder: function(data) {\r\n    var kmzFiles = this._listToObject(data);\r\n    var kmlDoc = this._getKmlDoc(kmzFiles);\r\n    var images = this._getImageFiles(Object.keys(kmzFiles));\r\n\r\n    var kmlString = kmzFiles[kmlDoc];\r\n\r\n    // replaces all images with their base64 encoding\r\n    for (var i in images) {\r\n      var imageUrl = images[i];\r\n      var dataUrl = kmzFiles[imageUrl];\r\n      kmlString = this._replaceAll(kmlString, imageUrl, dataUrl);\r\n    }\r\n    return kmlString;\r\n  },\r\n\r\n  _toXML: function(text) {\r\n    return (new DOMParser()).parseFromString(text, 'text/xml');\r\n  },\r\n\r\n  _toGeoJSON: function(xmlDoc) {\r\n    return (toGeoJSON || window.toGeoJSON).kml(xmlDoc);\r\n  },\r\n\r\n  _kmlToLayer: function(xmlDoc) {\r\n    var data = this._toGeoJSON(xmlDoc);\r\n\r\n    if (this.interactive) {\r\n      this.geojson = L.geoJson(data, {\r\n        pointToLayer: this._pointToLayer.bind(this),\r\n        onEachFeature: this._onEachFeature.bind(this),\r\n      });\r\n      this.layer = this.geojson;\r\n    }\r\n\r\n    if (this.tiled) {\r\n      this.gridlayer = L.gridLayer.geoJson(data, {\r\n        pointable: this.pointable,\r\n        ballon: this.options.ballon,\r\n        bindPopup: this.options.bindPopup,\r\n        bindTooltip: this.options.bindTooltip,\r\n      });\r\n      this.layer = this.interactive ? L.featureGroup([this.gridlayer, this.geojson]) : this.gridlayer;\r\n    }\r\n\r\n    if (this.layer) {\r\n      this._onKMZLoaded(this.layer, this.name);\r\n    }\r\n  },\r\n\r\n  _pointToLayer: function(feature, latlng) {\r\n    return new L.marker(latlng, {\r\n      icon: L.icon({\r\n        iconUrl: this.emptyIcon,\r\n      }),\r\n    });\r\n  },\r\n\r\n  _onEachFeature: function(feature, layer) {\r\n    switch (feature.geometry.type) {\r\n      case 'Point':\r\n        this._setLayerPointIcon(feature, layer);\r\n        break;\r\n      case 'LineString':\r\n      case 'Polygon':\r\n      case 'GeometryCollection':\r\n        this._setLayerStyle(feature, layer);\r\n        break;\r\n      default:\r\n        console.warn('Unsupported feature type: ' + feature.geometry.type, feature);\r\n        break;\r\n    }\r\n    this._setLayerBalloon(feature, layer);\r\n  },\r\n\r\n  _onKMZLoaded: function(layer, name) {\r\n    if (this.options.debug) console.log(layer, name);\r\n    if (this.callback) this.callback(layer, name);\r\n  },\r\n\r\n  _setLayerPointIcon: function(feature, layer) {\r\n    var width = 28;\r\n    var height = 28;\r\n    layer.setIcon(L.icon({\r\n      iconSize: [width, height],\r\n      iconAnchor: [width / 2, height / 2],\r\n      iconUrl: this.tiled ? this.emptyIcon : feature.properties.icon,\r\n    }));\r\n  },\r\n\r\n  _setLayerStyle: function(feature, layer) {\r\n    var styles = {\r\n      weight: 1,\r\n      opacity: 0,\r\n      fillOpacity: 0,\r\n    };\r\n    if (!this.tiled) {\r\n      if (feature.properties[\"stroke-width\"]) {\r\n        styles.weight = feature.properties[\"stroke-width\"] * 1.05;\r\n      }\r\n      if (feature.properties[\"stroke-opacity\"]) {\r\n        styles.opacity = feature.properties[\"stroke-opacity\"];\r\n      }\r\n      if (feature.properties[\"fill-opacity\"]) {\r\n        styles.fillOpacity = feature.properties[\"fill-opacity\"];\r\n      }\r\n      if (feature.properties.stroke) {\r\n        styles.color = feature.properties.stroke;\r\n      }\r\n      if (feature.properties.fill) {\r\n        styles.fillColor = feature.properties.fill;\r\n      }\r\n    }\r\n    layer.setStyle(styles);\r\n  },\r\n\r\n  _setLayerBalloon: function(feature, layer) {\r\n    if (!this.options.ballon) return;\r\n\r\n    var name = feature.properties.name ? feature.properties.name : \"\";\r\n    var desc = feature.properties.description ? feature.properties.description : \"\";\r\n\r\n    if (name || desc) {\r\n      if (this.options.bindPopup) {\r\n        layer.bindPopup('<div>' + '<b>' + name + '</b>' + '<br>' + desc + '</div>');\r\n      }\r\n      if (this.options.bindTooltip) {\r\n        layer.bindTooltip('<b>' + name + '</b>', {\r\n          direction: 'auto',\r\n          sticky: true,\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  _escapeRegExp: function(str) {\r\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\r\n  },\r\n\r\n  _replaceAll: function(str, find, replace) {\r\n    return str.replace(new RegExp(this._escapeRegExp(find), 'g'), replace);\r\n  },\r\n\r\n  _mapZipFiles: function(zip) {\r\n    return Object.keys(zip.files)\r\n      .map((name) => zip.files[name])\r\n      .map((entry) => entry\r\n        .async(\"blob\")\r\n        .then((value) => [entry.name, value]) // [ fileName, stringValue ]\r\n      );\r\n  },\r\n\r\n  _mapListFiles: function(list) {\r\n    return list.map(file => Promise.resolve().then(() => {\r\n      return this._readFile(file);\r\n    }));\r\n  },\r\n\r\n  _listToObject: function(list) {\r\n    return list\r\n      .reduce(function(newObj, listElem) {\r\n        newObj[listElem[0]] = listElem[1]; // { fileName: stringValue }\r\n        return newObj;\r\n      }, {} /* NB: do not remove, initial value */ );\r\n  },\r\n\r\n  _getFileExt: function(filename) {\r\n    return filename.split('.').pop().toLowerCase().replace('jpg', 'jpeg');\r\n  },\r\n\r\n  _getMimeType: function(filename, ext) {\r\n    var mime = 'text/plain';\r\n    if (/\\.(jpe?g|png|gif|bmp)$/i.test(filename)) {\r\n      mime = 'image/' + ext;\r\n    } else if (/\\.kml$/i.test(filename)) {\r\n      mime = 'text/plain';\r\n    }\r\n    return mime;\r\n  },\r\n\r\n  _getKmlDoc: function(files) {\r\n    return files[\"doc.kml\"] ? \"doc.kml\" : this._getKmlFiles(Object.keys(files))[0];\r\n  },\r\n\r\n  _getKmlFiles: function(files) {\r\n    return files.filter((file) => /.*\\.kml/.test(file));\r\n  },\r\n\r\n  _getImageFiles: function(files) {\r\n    return files.filter((file) => /\\.(jpe?g|png|gif|bmp)$/i.test(file));\r\n  },\r\n\r\n  /**\r\n   * It checks if a given file begins with PK, if so it's zipped\r\n   *\r\n   * @link https://en.wikipedia.org/wiki/List_of_file_signatures\r\n   */\r\n  _isZipped: function(file) {\r\n    var P = new Uint8Array(file, 0, 1); // offset, length\r\n    var K = new Uint8Array(file, 1, 1);\r\n    var PK = String.fromCharCode(P, K);\r\n    return 'PK' === PK;\r\n  },\r\n\r\n  _readFile: function(file) {\r\n    var filename = file[0];\r\n    var fileblob = file[1];\r\n    var ext = this._getFileExt(filename);\r\n    var mime = this._getMimeType(filename, ext);\r\n    return this._fileReader(fileblob, mime, filename);\r\n  },\r\n\r\n  _fileReader: function(blob, mime, name) {\r\n    return new Promise((resolve, reject) => {\r\n      var fr = new FileReader();\r\n      fr.onload = () => {\r\n        var result = fr.result;\r\n        if (mime.indexOf('text') === -1) {\r\n          var dataUrl = fr.result;\r\n          var base64 = dataUrl.split(',')[1];\r\n          result = 'data:' + mime + ';base64,' + base64;\r\n        }\r\n        return resolve([\r\n          name, result\r\n        ]);\r\n      };\r\n      if (mime.indexOf('text') === -1) {\r\n        fr.readAsDataURL(blob);\r\n      } else {\r\n        fr.readAsText(blob);\r\n      }\r\n    });\r\n  },\r\n\r\n  _getBinaryContent: function(path, callback) {\r\n    try {\r\n      var xhr = new window.XMLHttpRequest();\r\n      xhr.open('GET', path, true);\r\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n      xhr.responseType = \"arraybuffer\";\r\n      xhr.onreadystatechange = function(evt) {\r\n        var file, err;\r\n        if (xhr.readyState === 4) {\r\n          if (xhr.status === 200 || xhr.status === 0) {\r\n            file = null;\r\n            err = null;\r\n            try {\r\n              file = xhr.response || xhr.responseText;\r\n            } catch (e) {\r\n              err = new Error(e);\r\n            }\r\n            callback(err, file);\r\n          } else {\r\n            callback(new Error(\"Ajax error for \" + path + \" : \" + this.status + \" \" + this.statusText), null);\r\n          }\r\n        }\r\n      };\r\n      xhr.send();\r\n    } catch (e) {\r\n      callback(new Error(e), null);\r\n    }\r\n  },\r\n\r\n  _blobToString: function(b) {\r\n    var u, x;\r\n    u = URL.createObjectURL(b);\r\n    x = new XMLHttpRequest();\r\n    x.open('GET', u, false); // although sync, you're not fetching over internet\r\n    x.send();\r\n    URL.revokeObjectURL(u);\r\n    return x.responseText;\r\n  },\r\n\r\n  _blobToBase64: function(blob, callback) {\r\n    var reader = new FileReader();\r\n    reader.onload = function() {\r\n      var dataUrl = reader.result;\r\n      var base64 = dataUrl.split(',')[1];\r\n      callback(base64);\r\n    };\r\n    reader.readAsDataURL(blob);\r\n  },\r\n\r\n});\r\n\r\nexport var KMZLoader = L.KMZLoader;\r\n","/**\r\n * A plugin combining geojson-vt with leafletjs which is initially inspired by leaflet-geojson-vt.\r\n *\r\n * @author Brandonxiang, Raruto\r\n *\r\n * @link https://github.com/brandonxiang/leaflet-geojson-vt\r\n */\r\n\r\n// import geojsonvt from 'geojson-vt';\r\nimport 'leaflet-pointable';\r\n\r\nL.GridLayer.GeoJSON = L.GridLayer.extend({\r\n  options: {\r\n    pointable: false,\r\n    ballon: false,\r\n    bindPopup: false,\r\n    bindTooltip: false,\r\n    async: false,\r\n    maxZoom: 24,\r\n    tolerance: 3,\r\n    debug: 0,\r\n    extent: 4096,\r\n    buffer: 256,\r\n    icon: {\r\n      width: 28,\r\n      height: 28\r\n    },\r\n    styles: {\r\n      strokeWidth: 1,\r\n      strokeColor: '#f00',\r\n      strokeOpacity: 1.0,\r\n      fillColor: '#000',\r\n      fillOpacity: 0.25\r\n    }\r\n  },\r\n\r\n  initialize: function(geojson, options) {\r\n    L.setOptions(this, options);\r\n    L.GridLayer.prototype.initialize.call(this, options);\r\n    this.tileIndex = (geojsonvt || window.geojsonvt)(geojson, this.options);\r\n    this.geojson = geojson; // eg. saved for advanced \"leaflet-pip\" mouse/click integrations\r\n  },\r\n\r\n  onAdd: function(map) {\r\n    L.GridLayer.prototype.onAdd.call(this, map);\r\n    if (this.options.ballon) {\r\n      if (this.options.bindPopup) this._map.on(\"click\", this.updateBalloon, this);\r\n      if (this.options.bindTooltip) this._map.on(\"mousemove\", this.updateBalloon, this);\r\n    }\r\n  },\r\n\r\n  createTile: function(coords) {\r\n    var tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n    var size = this.getTileSize();\r\n    tile.width = size.x;\r\n    tile.height = size.y;\r\n    var ctx = tile.getContext('2d');\r\n\r\n    // return the tile so it can be rendered on screen\r\n    var tileInfo = this.tileIndex.getTile(coords.z, coords.x, coords.y);\r\n    var features = tileInfo ? tileInfo.features : [];\r\n    for (var i = 0; i < features.length; i++) {\r\n      this._drawFeature(ctx, features[i]);\r\n    }\r\n    return tile;\r\n  },\r\n\r\n  _drawFeature: function(ctx, feature) {\r\n    ctx.beginPath();\r\n    this._setStyle(ctx, feature);\r\n\r\n    if (feature.type === 1) this._drawIcon(ctx, feature);\r\n    else if (feature.type === 2) this._drawLine(ctx, feature);\r\n    else if (feature.type === 3) this._drawPolygon(ctx, feature);\r\n    else console.warn('Unsupported feature type: ' + feature.geometry.type, feature);\r\n\r\n    ctx.stroke();\r\n  },\r\n\r\n  _drawIcon: function(ctx, feature) {\r\n    var icon = new Image(),\r\n      p = feature.geometry[0],\r\n      width = this.options.icon.width,\r\n      height = this.options.icon.height;\r\n    icon.onload = function() {\r\n      ctx.drawImage(icon, (p[0] / 16.0) - (width / 2.0), (p[1] / 16.0) - (height / 2.0), width, height);\r\n    };\r\n    icon.src = feature.tags.icon ? feature.tags.icon : null;\r\n  },\r\n\r\n  _drawLine: function(ctx, feature) {\r\n    for (var j = 0; j < feature.geometry.length; j++) {\r\n      var ring = feature.geometry[j];\r\n      for (var k = 0; k < ring.length; k++) {\r\n        var p = ring[k];\r\n        if (k) ctx.lineTo(p[0] / 16.0, p[1] / 16.0);\r\n        else ctx.moveTo(p[0] / 16.0, p[1] / 16.0);\r\n      }\r\n    }\r\n  },\r\n\r\n  _drawPolygon: function(ctx, feature) {\r\n    this._drawLine(ctx, feature);\r\n    ctx.fill('evenodd');\r\n  },\r\n\r\n  _setStyle: function(ctx, feature) {\r\n    var style = {};\r\n\r\n    if (feature.type === 1) style = this._setPointStyle(feature, style);\r\n    else if (feature.type === 2) style = this._setLineStyle(feature, style);\r\n    else if (feature.type === 3) style = this._setPolygonStyle(feature, style);\r\n\r\n    ctx.lineWidth = style.stroke ? this._setWeight(style.weight) : 0;\r\n    ctx.strokeStyle = style.stroke ? this._setOpacity(style.stroke, style.opacity) : {};\r\n    ctx.fillStyle = style.fill ? this._setOpacity(style.fill, style.fillOpacity) : {};\r\n  },\r\n\r\n  _setPointStyle: function(feature, style) {\r\n    return style;\r\n  },\r\n\r\n  _setLineStyle: function(feature, style) {\r\n    style.weight = (feature.tags[\"stroke-width\"] ? feature.tags[\"stroke-width\"] : this.options.styles.strokeWidth) * 1.05;\r\n    style.opacity = feature.tags[\"stroke-opacity\"] ? feature.tags[\"stroke-opacity\"] : this.options.styles.strokeOpacity;\r\n    style.stroke = feature.tags.stroke ? feature.tags.stroke : this.options.styles.strokeColor;\r\n    return style;\r\n  },\r\n\r\n  _setPolygonStyle: function(feature, style) {\r\n    style = this._setLineStyle(feature, style);\r\n    style.fill = feature.tags.fill ? feature.tags.fill : this.options.styles.fillColor;\r\n    style.fillOpacity = feature.tags[\"fill-opacity\"] ? feature.tags[\"fill-opacity\"] : this.options.styles.fillOpacity;\r\n    return style;\r\n  },\r\n\r\n  _setWeight: function(weight) {\r\n    return weight || 5;\r\n  },\r\n\r\n  _setOpacity: function(color, opacity) {\r\n    color = color || '#f00';\r\n    if (opacity && this._iscolorHex(color)) {\r\n      var colorRgb = this._colorRgb(color);\r\n      return \"rgba(\" + colorRgb[0] + \",\" + colorRgb[1] + \",\" + colorRgb[2] + \",\" + opacity + \")\";\r\n    }\r\n    return color;\r\n  },\r\n\r\n  _iscolorHex: function(color) {\r\n    return /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(color.toLowerCase());\r\n  },\r\n\r\n  _colorRgb: function(color) {\r\n    var sColor = color.toLowerCase();\r\n    if (sColor.length === 4) {\r\n      var sColorNew = \"#\";\r\n      for (var i = 1; i < 4; i += 1) {\r\n        sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));\r\n      }\r\n      sColor = sColorNew;\r\n    }\r\n    var sColorChange = [];\r\n    for (var j = 1; j < 7; j += 2) {\r\n      sColorChange.push(parseInt(\"0x\" + sColor.slice(j, j + 2)));\r\n    }\r\n    return sColorChange;\r\n  },\r\n\r\n  /**\r\n   * Point in Polygon: ray-casting algorithm\r\n   *\r\n   * @link http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\r\n   */\r\n  _pointInPolygon: function(point, vs) {\r\n    var x = point[0];\r\n    var y = point[1];\r\n\r\n    var inside = false;\r\n    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {\r\n      var xi = vs[i][0];\r\n      var yi = vs[i][1];\r\n      var xj = vs[j][0];\r\n      var yj = vs[j][1];\r\n\r\n      var intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\r\n      if (intersect) inside = !inside;\r\n    }\r\n\r\n    return inside;\r\n  },\r\n\r\n  _getLatLngsPoly: function(feature, i) {\r\n    var o = [];\r\n    var geometry = feature.geometry || feature;\r\n    var coords = geometry.type == \"Polygon\" ? geometry.coordinates[0] : geometry.coordinates;\r\n    for (var j = i || 0; j < coords.length; j++) {\r\n      o[i++] = [coords[j][0], coords[j][1]];\r\n    }\r\n    return o.length ? o : false;\r\n  },\r\n\r\n  _getLatLngsPoint: function(feature, i) {\r\n    var o = [];\r\n    var geometry = feature.geometry || feature;\r\n    var coords = geometry.coordinates;\r\n    o[i || 0] = [coords[0], coords[1]];\r\n    return o.length ? o : false;\r\n  },\r\n\r\n  _getLatLngs: function(feature, i) {\r\n    var o = [];\r\n    i = i || 0;\r\n    var coords;\r\n\r\n    var geometry = feature.geometry || feature;\r\n    var type = geometry.type;\r\n\r\n    if (type == \"Point\") {\r\n      coords = this._getLatLngsPoint(feature, i);\r\n      if (coords) Array.prototype.push.apply(o, coords);\r\n    } else if (type == \"LineString\" || type == \"Polygon\") {\r\n      coords = this._getLatLngsPoly(feature, i);\r\n      if (coords) Array.prototype.push.apply(o, coords);\r\n    } else if (type == \"GeometryCollection\") {\r\n      var polys = geometry.geometries;\r\n      for (var j = 0; j < polys.length; j++) {\r\n        coords = this._getLatLngs(polys[j], i);\r\n        if (coords) Array.prototype.push.apply(o, coords);\r\n      }\r\n    } else {\r\n      console.warn(\"Unsupported feature type: \" + type);\r\n    }\r\n    return o.length ? o : false;\r\n  },\r\n\r\n  /**\r\n   * (EXPERIMENTAL) Inspired by: https://github.com/mapbox/leaflet-pip\r\n   *\r\n   * TODO: add/check support for Points, Lines and \"donuts\" Polygons\r\n   */\r\n  pointInLayer: function(p, layer, first) {\r\n    if (p instanceof L.LatLng) p = [p.lng, p.lat];\r\n    var results = [];\r\n\r\n    layer = layer || this.geojson;\r\n    first = first || true;\r\n    var features = layer.features;\r\n\r\n    for (var i = 0; i < features.length; i++) {\r\n      if (first && results.length) break;\r\n      var coords = this._getLatLngs(features[i]);\r\n      if (coords) {\r\n        var inside = this._pointInPolygon(p, coords); // NB. works only with polygons (see: https://observablehq.com/@tmcw/understanding-point-in-polygon).\r\n        if (inside) results.push(features[i]);\r\n      }\r\n    }\r\n    return results.length ? results : false;\r\n  },\r\n\r\n  /**\r\n   * (EXPERIMENTAL) Inspired by: https://github.com/Raruto/leaflet-pointable\r\n   */\r\n  updateBalloon: function(e) {\r\n    if (!this._map || !this.options.pointable || !this._map.isPointablePixel() || !this.isPointablePixel()) return;\r\n    this._popup = this._popup || new L.Popup();\r\n    var points = this.pointInLayer(e.latlng, this.geojson);\r\n    if (points) {\r\n      var feature = points[0];\r\n      var name = feature.properties.name || \"\";\r\n      if (name) {\r\n        this._popup.setLatLng(e.latlng);\r\n        this._popup.setContent('<b>' + name + '</b>');\r\n        this._popup.openOn(this._map);\r\n      }\r\n    } else {\r\n      this._map.closePopup(this._popup);\r\n    }\r\n  },\r\n\r\n});\r\n\r\nL.gridLayer.geoJson = function(geojson, options) {\r\n  return new L.GridLayer.GeoJSON(geojson, options);\r\n};\r\n\r\nexport var GridLayer = {\r\n  GeoJSON: L.GridLayer.GeoJSON,\r\n};\r\n\r\nexport var gridLayer = {\r\n  geoJSON: L.gridLayer.geoJson,\r\n};\r\n"],"names":["L","KMZParser","Class","extend","initialize","opts","setOptions","this","loaders","load","kmzUrl","_loadAsyncJS","_waitAsyncJS","_loadKMZ","bind","get","i","length","kmzLoader","KMZLoader","options","parse","push","_jsPromise","urls","host","JSZip","window","toGeoJSON","geojsonvt","promises","map","url","_loadJS","_jsPromisePending","Promise","all","then","resolve","reject","tag","document","createElement","type","src","onload","onerror","head","appendChild","callback","call","tiled","interactive","ballon","bindPopup","bindTooltip","debug","pointable","emptyIcon","name","onKMZLoaded","split","pop","_load","_getBinaryContent","err","data","console","error","_parse","_isZipped","_parseKMZ","_parseKML","that","loadAsync","zip","_mapZipFiles","list","_mapListFiles","kmlString","_decodeKMZFolder","_decodeKMLString","xmlDoc","_toXML","_kmlToLayer","ArrayBuffer","String","fromCharCode","apply","Uint8Array","kmzFiles","_listToObject","kmlDoc","_getKmlDoc","images","_getImageFiles","Object","keys","imageUrl","dataUrl","_replaceAll","text","DOMParser","parseFromString","_toGeoJSON","kml","geojson","geoJson","pointToLayer","_pointToLayer","onEachFeature","_onEachFeature","layer","gridlayer","gridLayer","featureGroup","_onKMZLoaded","feature","latlng","marker","icon","iconUrl","geometry","_setLayerPointIcon","_setLayerStyle","warn","_setLayerBalloon","log","setIcon","iconSize","iconAnchor","width","height","properties","styles","weight","opacity","fillOpacity","stroke","color","fill","fillColor","setStyle","desc","description","direction","sticky","_escapeRegExp","str","replace","find","RegExp","files","entry","async","value","file","_readFile","reduce","newObj","listElem","_getFileExt","filename","toLowerCase","_getMimeType","ext","mime","test","_getKmlFiles","filter","P","K","fileblob","_fileReader","blob","fr","FileReader","result","indexOf","base64","readAsDataURL","readAsText","path","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onreadystatechange","evt","readyState","status","response","responseText","e","Error","statusText","send","_blobToString","b","u","x","URL","createObjectURL","revokeObjectURL","_blobToBase64","reader","GridLayer","GeoJSON","maxZoom","tolerance","extent","buffer","strokeWidth","strokeColor","strokeOpacity","prototype","tileIndex","onAdd","_map","on","updateBalloon","createTile","coords","tile","DomUtil","create","size","getTileSize","y","ctx","getContext","tileInfo","getTile","z","features","_drawFeature","beginPath","_setStyle","_drawIcon","_drawLine","_drawPolygon","Image","p","drawImage","tags","j","ring","k","lineTo","moveTo","style","_setPointStyle","_setLineStyle","_setPolygonStyle","lineWidth","_setWeight","strokeStyle","_setOpacity","fillStyle","_iscolorHex","colorRgb","_colorRgb","sColor","sColorNew","slice","concat","sColorChange","parseInt","_pointInPolygon","point","vs","inside","xi","yi","xj","yj","_getLatLngsPoly","o","coordinates","_getLatLngsPoint","_getLatLngs","Array","polys","geometries","pointInLayer","first","LatLng","lng","lat","results","isPointablePixel","_popup","Popup","points","setLatLng","setContent","openOn","closePopup","geoJSON"],"mappings":"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"}