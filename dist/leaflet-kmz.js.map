{"version":3,"file":"leaflet-kmz.js","sources":["../src/utils.js","../src/KMZLayer.js","../src/KMZMarker.js"],"sourcesContent":["// import JSZip from 'jszip';\r\n// import * as toGeoJSON from '@tmcw/togeojson';\r\n\r\nexport function loadFile(url) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.open('GET', url);\r\n\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\t\txhr.responseType = \"arraybuffer\";\r\n\t\txhr.onload = () => {\r\n\t\t\tif (xhr.readyState === 4 && (xhr.status === 200 || xhr.status === 0)) {\r\n\t\t\t\tresolve(xhr.response || xhr.responseText);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\nexport function getKmlDoc(files) {\r\n\treturn files[\"doc.kml\"] ? \"doc.kml\" : getKmlFiles(Object.keys(files))[0];\r\n}\r\n\r\nexport function getKmlFiles(files) {\r\n\treturn files.filter((file) => isKmlFile(file));\r\n}\r\n\r\nexport function getImageFiles(files) {\r\n\treturn files.filter((file) => isImageFile(file));\r\n}\r\n\r\nexport function getFileExt(filename) {\r\n\treturn filename.split('.').pop().toLowerCase().replace('jpg', 'jpeg');\r\n}\r\n\r\nexport function getFileName(url) {\r\n\treturn url.split('/').pop();\r\n}\r\n\r\nexport function getMimeType(filename, ext) {\r\n\tvar mime = 'text/plain';\r\n\tif (/\\.(jpe?g|png|gif|bmp)$/i.test(filename)) {\r\n\t\tmime = 'image/' + ext;\r\n\t} else if (/\\.kml$/i.test(filename)) {\r\n\t\tmime = 'text/plain';\r\n\t}\r\n\treturn mime;\r\n}\r\n\r\nexport function isImageFile(filename) {\r\n\treturn /\\.(jpe?g|png|gif|bmp)$/i.test(filename);\r\n}\r\n\r\nexport function isKmlFile(filename) {\r\n\treturn /.*\\.kml/.test(filename);\r\n}\r\n\r\n/**\r\n * It checks if a given file begins with PK, if so it's zipped\r\n *\r\n * @link https://en.wikipedia.org/wiki/List_of_file_signatures\r\n */\r\nexport function isZipped(file) {\r\n\treturn 'PK' === String.fromCharCode(new Uint8Array(file, 0, 1), new Uint8Array(file, 1, 1));\r\n}\r\n\r\nexport function lazyLoader(urls, promise) {\r\n\treturn promise instanceof Promise ? promise : Promise.all(urls.map(url => loadJS(url)))\r\n}\r\n\r\nexport function loadJS(url) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve.bind(url), { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\nexport function toGeoJSON(data, props) {\r\n\tvar xml = data instanceof XMLDocument ? data : toXML(data);\r\n\tvar json = window.toGeoJSON.kml(xml);\r\n\tjson.properties = L.extend({}, json.properties, props || {});\r\n\treturn json;\r\n}\r\n\r\nexport function toXML(data) {\r\n\tvar text = data instanceof ArrayBuffer ? String.fromCharCode.apply(null, new Uint8Array(data)) : data;\r\n\treturn (new DOMParser()).parseFromString(text, 'text/xml');\r\n}\r\n\r\nexport function unzip(folder) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\twindow.JSZip.loadAsync(folder)\r\n\t\t\t.then((zip) => {\r\n\r\n\t\t\t\t// Parse KMZ files.\r\n\t\t\t\tvar files = Object.keys(zip.files)\r\n\t\t\t\t\t.map((name) => {\r\n\t\t\t\t\t\tvar entry = zip.files[name];\r\n\t\t\t\t\t\tif (isImageFile(name)) {\r\n\t\t\t\t\t\t\tvar ext = getFileExt(name);\r\n\t\t\t\t\t\t\tvar mime = getMimeType(name, ext);\r\n\t\t\t\t\t\t\treturn entry\r\n\t\t\t\t\t\t\t\t.async(\"base64\")\r\n\t\t\t\t\t\t\t\t.then((value) => [name, 'data:' + mime + ';base64,' + value]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn entry\r\n\t\t\t\t\t\t\t.async(\"text\")\r\n\t\t\t\t\t\t\t.then((value) => [name, value]); // [ fileName, stringValue ]\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t// Return KMZ files.\r\n\t\t\t\tPromise.all(files).then((list) =>\r\n\t\t\t\t\tresolve(list.reduce((obj, item) => {\r\n\t\t\t\t\t\tobj[item[0]] = item[1]; // { fileName: stringValue }\r\n\t\t\t\t\t\treturn obj;\r\n\t\t\t\t\t}, {}))\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t});\r\n}\r\n","import * as _ from './utils';\r\n\r\nexport const KMZLayer = L.KMZLayer = L.FeatureGroup.extend({\r\n\toptions: {\r\n\t\tinteractive: true,\r\n\t\tballon: true,\r\n\t\tbindPopup: true,\r\n\t\tbindTooltip: true,\r\n\t},\r\n\r\n\tinitialize: function(kmzUrl, options) {\r\n\t\tL.extend(this.options, options);\r\n\r\n\t\tthis.tiled = this.options.tiled; // (Optimized) GeoJSON Vector Tiles [\"geojson-vt.js\"] library.\r\n\t\tthis.interactive = this.options.interactive; // (Default) Mouse interactions through [\"leaflet.js\"] layers.\r\n\t\tthis.pointable = this.tiled && !this.interactive && this.options.pointable; // (Experimental) Optimized Mouse interactions through [\"geojson-vt.js\", \"leaflet-pointable.js\"] libraries.\r\n\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (kmzUrl) this.load(kmzUrl);\r\n\t},\r\n\r\n\tadd: function(kmzUrl) {\r\n\t\tthis.load(kmzUrl);\r\n\t},\r\n\r\n\tload: function(kmzUrl) {\r\n\t\tL.KMZLayer._jsPromise = _.lazyLoader(this._requiredJSModules(), L.KMZLayer._jsPromise)\r\n\t\t\t.then(() => this._load(kmzUrl));\r\n\t},\r\n\r\n\t_load: function(url) {\r\n\t\treturn _.loadFile(url).then((data) => this._parse(data, { name: _.getFileName(url) }));\r\n\t},\r\n\r\n\t_parse: function(data, props) {\r\n\t\treturn _.isZipped(data) ? this._parseKMZ(data, props) : this._parseKML(data, props);\r\n\t},\r\n\r\n\t_parseKMZ: function(data, props) {\r\n\t\t_.unzip(data).then((kmzFiles) => {\r\n\t\t\tvar kmlDoc = _.getKmlDoc(kmzFiles);\r\n\t\t\tvar images = _.getImageFiles(Object.keys(kmzFiles));\r\n\r\n\t\t\tvar kmlString = kmzFiles[kmlDoc];\r\n\t\t\t// cache all images with their base64 encoding\r\n\t\t\tvar icons = images.reduce((obj, item) => {\r\n\t\t\t\tobj[item] = kmzFiles[item];\r\n\t\t\t\treturn obj;\r\n\t\t\t}, {});\r\n\r\n\t\t\tthis._parseKML(kmlString, L.extend({}, props, { icons: icons }));\r\n\t\t});\r\n\t},\r\n\r\n\t_parseKML: function(data, props) {\r\n\t\tvar geojson = _.toGeoJSON(data, props);\r\n\t\tvar layer = (this.options.geometryToLayer || this._geometryToLayer).call(this, geojson);\r\n\t\tthis.addLayer(layer);\r\n\t\tthis.fire('load', { layer: layer, name: geojson.properties.name });\r\n\t},\r\n\r\n\t_geometryToLayer: function(data) {\r\n\t\tvar preferCanvas = (this._map && this._map.options.preferCanvas);\r\n\t\tvar layer = L.geoJson(data, {\r\n\t\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\t\tif (preferCanvas) {\r\n\t\t\t\t\treturn L.kmzMarker(latlng, {\r\n\t\t\t\t\t\ticonUrl: data.properties.icons[feature.properties.icon],\r\n\t\t\t\t\t\ticonSize: [28, 28],\r\n\t\t\t\t\t\ticonAnchor: [14, 14],\r\n\t\t\t\t\t\tinteractive: this.options.interactive,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t// TODO: handle L.svg renderer within the L.KMZMarker class?\r\n\t\t\t\treturn L.marker(latlng, {\r\n\t\t\t\t\ticon: L.icon({\r\n\t\t\t\t\t\ticonUrl: data.properties.icons[feature.properties.icon],\r\n\t\t\t\t\t\ticonSize: [28, 28],\r\n\t\t\t\t\t\ticonAnchor: [14, 14],\r\n\t\t\t\t\t}),\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tstyle: (feature) => {\r\n\t\t\t\tvar styles = {};\r\n\t\t\t\tvar prop = feature.properties;\r\n\r\n\t\t\t\tif (prop.stroke) {\r\n\t\t\t\t\tstyles.stroke = true;\r\n\t\t\t\t\tstyles.color = prop.stroke;\r\n\t\t\t\t}\r\n\t\t\t\tif (prop.fill) {\r\n\t\t\t\t\tstyles.fill = true;\r\n\t\t\t\t\tstyles.fillColor = prop.fill;\r\n\t\t\t\t}\r\n\t\t\t\tif (prop[\"stroke-opacity\"]) {\r\n\t\t\t\t\tstyles.opacity = prop[\"stroke-opacity\"];\r\n\t\t\t\t}\r\n\t\t\t\tif (prop[\"fill-opacity\"]) {\r\n\t\t\t\t\tstyles.fillOpacity = prop[\"fill-opacity\"];\r\n\t\t\t\t}\r\n\t\t\t\tif (prop[\"stroke-width\"]) {\r\n\t\t\t\t\tstyles.weight = prop[\"stroke-width\"] * 1.05;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn styles;\r\n\t\t\t},\r\n\t\t\tonEachFeature: (feature, layer) => {\r\n\t\t\t\tif (!this.options.ballon) return;\r\n\r\n\t\t\t\tvar prop = feature.properties;\r\n\t\t\t\tvar name = prop.name || \"\";\r\n\t\t\t\tvar desc = prop.description || \"\";\r\n\r\n\t\t\t\tif (name || desc) {\r\n\t\t\t\t\tif (this.options.bindPopup) {\r\n\t\t\t\t\t\tlayer.bindPopup('<div>' + '<b>' + name + '</b>' + '<br>' + desc + '</div>');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.options.bindTooltip) {\r\n\t\t\t\t\t\tlayer.bindTooltip('<b>' + name + '</b>', {\r\n\t\t\t\t\t\t\tdirection: 'auto',\r\n\t\t\t\t\t\t\tsticky: true,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinteractive: this.options.interactive,\r\n\t\t});\r\n\r\n\t\treturn layer;\r\n\t},\r\n\r\n\t_requiredJSModules: function() {\r\n\t\tvar urls = [];\r\n\t\tvar host = 'https://unpkg.com/';\r\n\r\n\t\tif (typeof window.JSZip !== 'function') {\r\n\t\t\turls.push(host + 'jszip@3.5.0/dist/jszip.min.js');\r\n\t\t}\r\n\t\tif (typeof window.toGeoJSON !== 'object') {\r\n\t\t\turls.push(host + '@tmcw/togeojson@4.1.0/dist/togeojson.umd.js');\r\n\t\t}\r\n\r\n\t\treturn urls;\r\n\t},\r\n});\r\n\r\nL.kmzLayer = function(url, options) {\r\n\treturn new L.KMZLayer(url, options);\r\n};\r\n","/**\r\n * Optimized leaflet canvas renderer to load numerous markers\r\n *\r\n * @link https://stackoverflow.com/a/51852641\r\n * @link https://stackoverflow.com/a/43019740\r\n *\r\n */\r\nL.KMZMarker = L.CircleMarker.extend({\r\n\tinitialize: function(latlng, options) {\r\n\t\tL.CircleMarker.prototype.initialize.call(this, latlng, options);\r\n\t\tvar icon = this._icon = new Image(options.iconSize[0], options.iconSize[1]);\r\n\t\ticon.anchor = [icon.width / 2.0, icon.height / 2.0];\r\n\t\ticon.src = this.options.iconUrl;\r\n\t},\r\n\t_updatePath: function() {\r\n\t\tvar renderer = this._renderer;\r\n\t\tvar icon = this._icon;\r\n\t\tvar layer = this;\r\n\r\n\t\tif (!icon.complete || !renderer._drawing || layer._empty()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar p = layer._point.subtract(icon.anchor);\r\n\t\tvar ctx = renderer._ctx;\r\n\r\n\t\tctx.drawImage(icon, p.x, p.y, icon.width, icon.height);\r\n\t}\r\n});\r\n\r\nL.kmzMarker = function(ll, opts) {\r\n\treturn new L.KMZMarker(ll, opts);\r\n};\r\n\r\nexport var KMZMarker = L.KMZMarker;\r\n"],"names":["getKmlDoc","files","filter","file","test","getKmlFiles","Object","keys","getFileName","url","split","pop","isImageFile","filename","lazyLoader","urls","promise","Promise","all","map","resolve","reject","tag","document","createElement","addEventListener","bind","once","src","head","appendChild","loadJS","toGeoJSON","data","props","xml","XMLDocument","text","ArrayBuffer","String","fromCharCode","apply","Uint8Array","DOMParser","parseFromString","toXML","json","window","kml","properties","L","extend","KMZLayer","FeatureGroup","options","interactive","ballon","bindPopup","bindTooltip","initialize","kmzUrl","this","tiled","pointable","_layers","load","add","_jsPromise","_.lazyLoader","_requiredJSModules","then","_load","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onload","readyState","status","console","warn","response","responseText","onerror","send","_.loadFile","_parse","name","_.getFileName","_parseKMZ","_parseKML","folder","JSZip","loadAsync","zip","entry","ext","toLowerCase","replace","mime","getMimeType","async","value","list","reduce","obj","item","kmzFiles","kmlDoc","_.getKmlDoc","images","kmlString","icons","geojson","_.toGeoJSON","layer","geometryToLayer","_geometryToLayer","call","addLayer","fire","preferCanvas","_map","geoJson","pointToLayer","feature","latlng","kmzMarker","iconUrl","icon","iconSize","iconAnchor","marker","style","styles","prop","stroke","color","fill","fillColor","opacity","fillOpacity","weight","onEachFeature","desc","description","direction","sticky","host","push","kmzLayer","KMZMarker","CircleMarker","prototype","_icon","Image","anchor","width","height","_updatePath","renderer","_renderer","complete","_drawing","_empty","p","_point","subtract","_ctx","drawImage","x","y","ll","opts"],"mappings":"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"}