{"version":3,"file":"leaflet-kmz.js","sources":["../src/utils.js","../src/KMZParser.js","../src/KMZLoader.js","../src/KMZMarker.js","../src/GridLayer.GeoJSON.js"],"sourcesContent":["// import JSZip from 'jszip';\r\n// import * as toGeoJSON from '@tmcw/togeojson';\r\n\r\nexport const blobToBase64 = (blob, callback) => {\r\n\tvar reader = new FileReader();\r\n\treader.onload = function() {\r\n\t\tvar dataUrl = reader.result;\r\n\t\tvar base64 = dataUrl.split(',')[1];\r\n\t\tcallback(base64);\r\n\t};\r\n\treader.readAsDataURL(blob);\r\n};\r\n\r\nexport const blobToString = (b) => {\r\n\tvar u, x;\r\n\tu = URL.createObjectURL(b);\r\n\tx = new XMLHttpRequest();\r\n\tx.open('GET', u, false); // although sync, you're not fetching over internet\r\n\tx.send();\r\n\tURL.revokeObjectURL(u);\r\n\treturn x.responseText;\r\n};\r\n\r\nexport const extractRGB = (color) => {\r\n\tvar sColor = color.toLowerCase();\r\n\tif (sColor.length === 4) {\r\n\t\tvar sColorNew = \"#\";\r\n\t\tfor (var i = 1; i < 4; i += 1) {\r\n\t\t\tsColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));\r\n\t\t}\r\n\t\tsColor = sColorNew;\r\n\t}\r\n\tvar sColorChange = [];\r\n\tfor (var j = 1; j < 7; j += 2) {\r\n\t\tsColorChange.push(parseInt(\"0x\" + sColor.slice(j, j + 2)));\r\n\t}\r\n\treturn sColorChange;\r\n};\r\n\r\nexport const decodeKMLString = (data) => {\r\n\treturn data instanceof ArrayBuffer ? String.fromCharCode.apply(null, new Uint8Array(data)) : data;\r\n};\r\n\r\nexport const decodeKMZFolder = (data) => {\r\n\tvar kmzFiles = listToObject(data);\r\n\tvar kmlDoc = getKmlDoc(kmzFiles);\r\n\tvar images = getImageFiles(Object.keys(kmzFiles));\r\n\r\n\tvar kmlString = kmzFiles[kmlDoc];\r\n\r\n\t// replaces all images with their base64 encoding\r\n\tfor (var i in images) {\r\n\t\tvar imageUrl = images[i];\r\n\t\tvar dataUrl = kmzFiles[imageUrl];\r\n\t\tkmlString = replaceAll(kmlString, imageUrl, dataUrl);\r\n\t}\r\n\treturn kmlString;\r\n};\r\n\r\n\r\nexport const escapeRegExp = (str) => {\r\n\treturn str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\r\n};\r\n\r\nexport const fileReader = (blob, mime, name) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tvar fr = new FileReader();\r\n\t\tfr.onload = () => {\r\n\t\t\tvar result = fr.result;\r\n\t\t\tif (mime.indexOf('text') === -1) {\r\n\t\t\t\tvar dataUrl = fr.result;\r\n\t\t\t\tvar base64 = dataUrl.split(',')[1];\r\n\t\t\t\tresult = 'data:' + mime + ';base64,' + base64;\r\n\t\t\t}\r\n\t\t\treturn resolve([\r\n\t\t\t\tname, result\r\n\t\t\t]);\r\n\t\t};\r\n\t\tif (mime.indexOf('text') === -1) {\r\n\t\t\tfr.readAsDataURL(blob);\r\n\t\t} else {\r\n\t\t\tfr.readAsText(blob);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport const getBinaryContent = (path, callback) => {\r\n\ttry {\r\n\t\tvar xhr = new window.XMLHttpRequest();\r\n\t\txhr.open('GET', path, true);\r\n\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n\t\txhr.responseType = \"arraybuffer\";\r\n\t\txhr.onreadystatechange = function(evt) {\r\n\t\t\tvar file, err;\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0) {\r\n\t\t\t\t\tfile = null;\r\n\t\t\t\t\terr = null;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tfile = xhr.response || xhr.responseText;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\terr = new Error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(err, file);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(new Error(\"Ajax error for \" + path + \" : \" + this.status + \" \" + this.statusText), null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send();\r\n\t} catch (e) {\r\n\t\tcallback(new Error(e), null);\r\n\t}\r\n};\r\n\r\nexport const getKmlDoc = (files) => {\r\n\treturn files[\"doc.kml\"] ? \"doc.kml\" : getKmlFiles(Object.keys(files))[0];\r\n};\r\n\r\nexport const getKmlFiles = (files) => {\r\n\treturn files.filter((file) => /.*\\.kml/.test(file));\r\n};\r\n\r\nexport const getImageFiles = (files) => {\r\n\treturn files.filter((file) => /\\.(jpe?g|png|gif|bmp)$/i.test(file));\r\n};\r\n\r\nexport const getFileExt = (filename) => {\r\n\treturn filename.split('.').pop().toLowerCase().replace('jpg', 'jpeg');\r\n};\r\n\r\nexport const getMimeType = (filename, ext) => {\r\n\tvar mime = 'text/plain';\r\n\tif (/\\.(jpe?g|png|gif|bmp)$/i.test(filename)) {\r\n\t\tmime = 'image/' + ext;\r\n\t} else if (/\\.kml$/i.test(filename)) {\r\n\t\tmime = 'text/plain';\r\n\t}\r\n\treturn mime;\r\n};\r\n\r\nexport const getLatLngsPoly = (feature, i) => {\r\n\tvar o = [];\r\n\tvar geometry = feature.geometry || feature;\r\n\tvar coords = geometry.type == \"Polygon\" ? geometry.coordinates[0] : geometry.coordinates;\r\n\tfor (var j = i || 0; j < coords.length; j++) {\r\n\t\to[i++] = [coords[j][0], coords[j][1]];\r\n\t}\r\n\treturn o.length ? o : false;\r\n};\r\n\r\nexport const getLatLngsPoint = (feature, i) => {\r\n\tvar o = [];\r\n\tvar geometry = feature.geometry || feature;\r\n\tvar coords = geometry.coordinates;\r\n\to[i || 0] = [coords[0], coords[1]];\r\n\treturn o.length ? o : false;\r\n};\r\n\r\nexport const getLatLngs = (feature, i) => {\r\n\tvar o = [];\r\n\ti = i || 0;\r\n\tvar coords;\r\n\r\n\tvar geometry = feature.geometry || feature;\r\n\tvar type = geometry.type;\r\n\r\n\tif (type == \"Point\") {\r\n\t\tcoords = getLatLngsPoint(feature, i);\r\n\t\tif (coords) o.push(coords);\r\n\t} else if (type == \"LineString\" || type == \"Polygon\") {\r\n\t\tcoords = getLatLngsPoly(feature, i);\r\n\t\tif (coords) o.push(coords);\r\n\t} else if (type == \"GeometryCollection\") {\r\n\t\tvar polys = geometry.geometries;\r\n\t\tfor (var j = 0; j < polys.length; j++) {\r\n\t\t\tcoords = getLatLngs(polys[j], i);\r\n\t\t\tif (coords) o.push(coords);\r\n\t\t}\r\n\t} else {\r\n\t\tconsole.warn(\"Unsupported feature type: \" + type);\r\n\t}\r\n\treturn o.length ? o : false;\r\n};\r\n\r\nexport const iscolorHex = (color) => {\r\n\treturn /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(color.toLowerCase());\r\n};\r\n\r\n/**\r\n * It checks if a given file begins with PK, if so it's zipped\r\n *\r\n * @link https://en.wikipedia.org/wiki/List_of_file_signatures\r\n */\r\nexport const isZipped = (file) => {\r\n\tvar P = new Uint8Array(file, 0, 1); // offset, length\r\n\tvar K = new Uint8Array(file, 1, 1);\r\n\tvar PK = String.fromCharCode(P, K);\r\n\treturn 'PK' === PK;\r\n};\r\n\r\nexport const listToObject = (list) => {\r\n\treturn list.reduce((obj, item) => {\r\n\t\tobj[item[0]] = item[1]; // { fileName: stringValue }\r\n\t\treturn obj;\r\n\t}, {});\r\n};\r\n\r\nexport const loadJS = (url) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tvar tag = document.createElement(\"script\");\r\n\t\ttag.type = \"text/javascript\";\r\n\t\ttag.src = url;\r\n\t\ttag.onload = resolve.bind(url);\r\n\t\ttag.onerror = reject.bind(url);\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n};\r\n\r\nexport const mapZipFiles = (zip) => {\r\n\treturn Object.keys(zip.files)\r\n\t\t.map((name) => zip.files[name])\r\n\t\t.map((entry) => entry\r\n\t\t\t.async(\"blob\")\r\n\t\t\t.then((value) => [entry.name, value]) // [ fileName, stringValue ]\r\n\t\t);\r\n};\r\n\r\nexport const mapListFiles = (list) => {\r\n\treturn list\r\n\t\t.map(file => Promise.resolve().then(() => readFile(file)));\r\n};\r\n\r\nexport const parseKMZFolder = (zip) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tPromise.all(mapZipFiles(zip)).then((list) => {\r\n\t\t\tPromise.all(mapListFiles(list)).then((data) => {\r\n\t\t\t\treturn resolve(decodeKMZFolder(data));\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n};\r\n\r\n/**\r\n * Point in Polygon: ray-casting algorithm\r\n *\r\n * @link http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\r\n */\r\nexport const pointInPolygon = (point, vs) => {\r\n\tvar x = point[0];\r\n\tvar y = point[1];\r\n\r\n\tvar inside = false;\r\n\tfor (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {\r\n\t\tvar xi = vs[i][0];\r\n\t\tvar yi = vs[i][1];\r\n\t\tvar xj = vs[j][0];\r\n\t\tvar yj = vs[j][1];\r\n\r\n\t\tvar intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\r\n\t\tif (intersect) inside = !inside;\r\n\t}\r\n\r\n\treturn inside;\r\n};\r\n\r\n/**\r\n * (EXPERIMENTAL) Inspired by: https://github.com/mapbox/leaflet-pip\r\n *\r\n * TODO: add/check support for Points, Lines and \"donuts\" Polygons\r\n */\r\nexport const pointInLayer = (p, layer, first) => {\r\n\tif (p instanceof L.LatLng) p = [p.lng, p.lat];\r\n\tvar results = [];\r\n\r\n\tfirst = first || true;\r\n\tvar features = layer.features;\r\n\r\n\tfor (var i = 0; i < features.length; i++) {\r\n\t\tif (first && results.length) break;\r\n\t\tvar coords = getLatLngs(features[i]);\r\n\t\tif (coords) {\r\n\t\t\tvar inside = pointInPolygon(p, coords); // NB. works only with polygons (see: https://observablehq.com/@tmcw/understanding-point-in-polygon).\r\n\t\t\tif (inside) results.push(features[i]);\r\n\t\t}\r\n\t}\r\n\treturn results.length ? results : false;\r\n};\r\n\r\nexport const readFile = (file) => {\r\n\tvar filename = file[0];\r\n\tvar fileblob = file[1];\r\n\tvar ext = getFileExt(filename);\r\n\tvar mime = getMimeType(filename, ext);\r\n\treturn fileReader(fileblob, mime, filename);\r\n};\r\n\r\nexport const replaceAll = (str, find, replace) => {\r\n\treturn str.replace(new RegExp(escapeRegExp(find), 'g'), replace);\r\n};\r\n\r\nexport const toGeoJSON = (xmlDoc) => {\r\n\treturn window.toGeoJSON.kml(xmlDoc);\r\n};\r\n\r\nexport const toXML = (text) => {\r\n\treturn (new DOMParser()).parseFromString(text, 'text/xml');\r\n};\r\n\r\nexport const toRGBA = (color, alpha) => {\r\n\tif (alpha && iscolorHex(color)) {\r\n\t\tvar colorRgb = extractRGB(color);\r\n\t\treturn \"rgba(\" + colorRgb[0] + \",\" + colorRgb[1] + \",\" + colorRgb[2] + \",\" + alpha + \")\";\r\n\t}\r\n\treturn color;\r\n};\r\n\r\nexport const unzip = (data) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\twindow.JSZip.loadAsync(data)\r\n\t\t\t.then((zip) =>\r\n\t\t\t\tparseKMZFolder(zip)\r\n\t\t\t\t.then((kmlString) => resolve(kmlString))\r\n\t\t\t);\r\n\t});\r\n};\r\n","import * as _ from './utils';\r\n\r\nL.KMZParser = L.Class.extend({\r\n\r\n\tinitialize: function(opts) {\r\n\t\tL.setOptions(this, opts);\r\n\t\tthis.loaders = [];\r\n\t},\r\n\r\n\tload: function(kmzUrl, opts) {\r\n\t\tthis._loadAsyncJS(this._requiredJSModules()); // async download all required JS modules.\r\n\t\tthis._waitAsyncJS(this._loadKMZ.bind(this, kmzUrl, opts)); // wait until all JS modules are downloaded.\r\n\t},\r\n\r\n\tget: function(i) {\r\n\t\treturn i < this.loaders.length ? this.loaders[i] : false;\r\n\t},\r\n\r\n\t_loadKMZ: function(kmzUrl, opts) {\r\n\t\tvar kmzLoader = new L.KMZLoader(L.extend({}, this.options, opts));\r\n\t\tkmzLoader.parse(kmzUrl);\r\n\t\tthis.loaders.push(kmzLoader);\r\n\t},\r\n\r\n\t_loadAsyncJS: function(urls) {\r\n\t\tif (!L.KMZParser._jsPromise && urls.length) {\r\n\t\t\tvar promises = urls.map(url => _.loadJS(url));\r\n\t\t\tL.KMZParser._jsPromisePending = true;\r\n\t\t\tL.KMZParser._jsPromise = Promise.all(promises).then(function() {\r\n\t\t\t\tL.KMZParser._jsPromisePending = false;\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t},\r\n\r\n\t_requiredJSModules: function() {\r\n\t\tvar urls = [];\r\n\t\tvar host = 'https://unpkg.com/';\r\n\r\n\t\tif (typeof window.JSZip !== 'function') {\r\n\t\t\turls.push(host + 'jszip@3.1.5/dist/jszip.min.js');\r\n\t\t}\r\n\t\tif (typeof window.toGeoJSON !== 'object') {\r\n\t\t\turls.push(host + '@tmcw/togeojson@3.0.1/dist/togeojsons.min.js');\r\n\t\t}\r\n\t\tif (typeof window.geojsonvt !== 'function') {\r\n\t\t\turls.push(host + 'geojson-vt@3.0.0/geojson-vt.js');\r\n\t\t}\r\n\r\n\t\treturn urls;\r\n\t},\r\n\r\n\t_waitAsyncJS: function(callback) {\r\n\t\tif (L.KMZParser._jsPromise && L.KMZParser._jsPromisePending) {\r\n\t\t\tL.KMZParser._jsPromise.then(callback);\r\n\t\t} else {\r\n\t\t\tcallback.call();\r\n\t\t}\r\n\t},\r\n\r\n});\r\n\r\nexport var KMZParser = L.KMZParser;\r\n","import * as _ from './utils';\r\n\r\nL.KMZLoader = L.Class.extend({\r\n\toptions: {\r\n\t\trenderer: true,\r\n\t\ttiled: true,\r\n\t\tinteractive: true,\r\n\t\tballon: true,\r\n\t\tbindPopup: true,\r\n\t\tbindTooltip: true,\r\n\t\tdebug: 0,\r\n\t\tkeepFront: true,\r\n\t\temptyIcon: \"data:image/png;\" + \"base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAFElEQVR4XgXAAQ0AAABAMP1L30IDCPwC/o5WcS4AAAAASUVORK5CYII=\"\r\n\t},\r\n\r\n\tinitialize: function(opts) {\r\n\r\n\t\tL.setOptions(this, opts);\r\n\r\n\t\tthis.renderer = this.options.renderer;\r\n\t\tthis.tiled = this.options.tiled; // (Optimized) GeoJSON Vector Tiles [\"geojson-vt.js\"] library.\r\n\t\tthis.interactive = this.options.interactive; // (Default) Mouse interactions through [\"leaflet.js\"] layers.\r\n\t\tthis.pointable = this.tiled && !this.interactive && this.options.pointable; // (Experimental) Optimized Mouse interactions through [\"geojson-vt.js\", \"leaflet-pointable.js\"] libraries.\r\n\t\tthis.emptyIcon = this.options.emptyIcon;\r\n\t\tthis.name = this.options.name;\r\n\t\tthis.callback = opts.onKMZLoaded;\r\n\t},\r\n\r\n\tparse: function(kmzUrl) {\r\n\t\tthis.name = this.name ? this.name : kmzUrl.split('/').pop();\r\n\t\tthis._load(kmzUrl);\r\n\t},\r\n\r\n\t_load: function(url) {\r\n\t\t_.getBinaryContent(url,\r\n\t\t\t(err, data) => {\r\n\t\t\t\tif (err != null) console.error(url, err, data);\r\n\t\t\t\telse this._parse(data);\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t_parse: function(data) {\r\n\t\treturn _.isZipped(data) ? this._parseKMZ(data) : this._parseKML(data);\r\n\t},\r\n\r\n\t_parseKMZ: function(data) {\r\n\t\t_.unzip(data).then((kml) => this._parseKML(kml));\r\n\t},\r\n\r\n\t_parseKML: function(data) {\r\n\t\tvar kmlString = _.decodeKMLString(data);\r\n\t\tvar xmlDoc = _.toXML(kmlString);\r\n\t\tthis._kmlToLayer(xmlDoc);\r\n\t},\r\n\r\n\t_keepFront: function(layer) {\r\n\t\tvar keepFront = function(e) {\r\n\t\t\tif (this.bringToFront) this.bringToFront();\r\n\t\t}.bind(layer);\r\n\t\tlayer.on('add', function(e) {\r\n\t\t\tthis._map.on('baselayerchange', keepFront);\r\n\t\t});\r\n\t\tlayer.on('remove', function(e) {\r\n\t\t\tthis._map.off('baselayerchange', keepFront);\r\n\t\t});\r\n\t},\r\n\r\n\t_kmlToLayer: function(xmlDoc) {\r\n\t\tvar data = _.toGeoJSON(xmlDoc);\r\n\r\n\t\tif (this.interactive) {\r\n\t\t\tthis.geojson = L.geoJson(data, {\r\n\t\t\t\tpointToLayer: this._pointToLayer.bind(this),\r\n\t\t\t\tonEachFeature: this._onEachFeature.bind(this),\r\n\t\t\t\tkmzRenderer: this.renderer,\r\n\t\t\t});\r\n\t\t\tthis.layer = this.geojson;\r\n\t\t}\r\n\r\n\t\tif (this.tiled) {\r\n\t\t\tthis.gridlayer = L.gridLayer.geoJson(data, {\r\n\t\t\t\tpointable: this.pointable,\r\n\t\t\t\tballon: this.options.ballon,\r\n\t\t\t\tbindPopup: this.options.bindPopup,\r\n\t\t\t\tbindTooltip: this.options.bindTooltip,\r\n\t\t\t});\r\n\t\t\tthis.layer = this.interactive ? L.featureGroup([this.gridlayer, this.geojson]) : this.gridlayer;\r\n\t\t}\r\n\r\n\t\tif (this.layer) {\r\n\t\t\tthis._onKMZLoaded(this.layer, this.name);\r\n\t\t}\r\n\t},\r\n\r\n\t_pointToLayer: function(feature, latlng) {\r\n\t\treturn new L.KMZMarker(latlng, {\r\n\t\t\tkmzRenderer: this.renderer,\r\n\t\t});\r\n\t\t// return new L.marker(latlng, {\r\n\t\t//   icon: L.icon({\r\n\t\t//   \ticonUrl: this.emptyIcon,\r\n\t\t//   }),\r\n\t\t// });\r\n\t},\r\n\r\n\t_onEachFeature: function(feature, layer) {\r\n\t\tswitch (feature.geometry.type) {\r\n\t\t\tcase 'Point':\r\n\t\t\t\tthis._setLayerPointIcon(feature, layer);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'LineString':\r\n\t\t\tcase 'Polygon':\r\n\t\t\tcase 'GeometryCollection':\r\n\t\t\t\tthis._setLayerStyle(feature, layer);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn('Unsupported feature type: ' + feature.geometry.type, feature);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis._setLayerBalloon(feature, layer);\r\n\t},\r\n\r\n\t_onKMZLoaded: function(layer, name) {\r\n\t\tif (this.options.debug) console.log(layer, name);\r\n\t\tif (this.options.keepFront) this._keepFront(layer);\r\n\t\tif (this.callback) this.callback(layer, name);\r\n\t},\r\n\r\n\t_setLayerPointIcon: function(feature, layer) {\r\n\t\tlayer.setIconUrl(this.tiled ? this.emptyIcon : feature.properties.icon);\r\n\t\t// var width = 28;\r\n\t\t// var height = 28;\r\n\t\t// layer.setIcon(L.icon({\r\n\t\t// \ticonSize: [width, height],\r\n\t\t// \ticonAnchor: [width / 2, height / 2],\r\n\t\t// \ticonUrl: this.tiled ? this.emptyIcon : feature.properties.icon,\r\n\t\t// }));\r\n\t},\r\n\r\n\t_setLayerStyle: function(feature, layer) {\r\n\t\tvar styles = {\r\n\t\t\tweight: 1,\r\n\t\t\topacity: 0,\r\n\t\t\tfillOpacity: 0,\r\n\t\t};\r\n\t\tif (!this.tiled) {\r\n\t\t\tif (feature.properties[\"stroke-width\"]) {\r\n\t\t\t\tstyles.weight = feature.properties[\"stroke-width\"] * 1.05;\r\n\t\t\t}\r\n\t\t\tif (feature.properties[\"stroke-opacity\"]) {\r\n\t\t\t\tstyles.opacity = feature.properties[\"stroke-opacity\"];\r\n\t\t\t}\r\n\t\t\tif (feature.properties[\"fill-opacity\"]) {\r\n\t\t\t\tstyles.fillOpacity = feature.properties[\"fill-opacity\"];\r\n\t\t\t}\r\n\t\t\tif (feature.properties.stroke) {\r\n\t\t\t\tstyles.color = feature.properties.stroke;\r\n\t\t\t}\r\n\t\t\tif (feature.properties.fill) {\r\n\t\t\t\tstyles.fillColor = feature.properties.fill;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlayer.setStyle(styles);\r\n\t},\r\n\r\n\t_setLayerBalloon: function(feature, layer) {\r\n\t\tif (!this.options.ballon) return;\r\n\r\n\t\tvar name = feature.properties.name ? feature.properties.name : \"\";\r\n\t\tvar desc = feature.properties.description ? feature.properties.description : \"\";\r\n\r\n\t\tif (name || desc) {\r\n\t\t\tif (this.options.bindPopup) {\r\n\t\t\t\tlayer.bindPopup('<div>' + '<b>' + name + '</b>' + '<br>' + desc + '</div>');\r\n\t\t\t}\r\n\t\t\tif (this.options.bindTooltip) {\r\n\t\t\t\tlayer.bindTooltip('<b>' + name + '</b>', {\r\n\t\t\t\t\tdirection: 'auto',\r\n\t\t\t\t\tsticky: true,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Include a default canvas renderer to each initialized map.\r\n */\r\nvar mapProto = L.Map.prototype;\r\nvar getRendererMapProto = mapProto.getRenderer;\r\nL.Map.addInitHook(function() {\r\n\tthis.options.kmzRenderer = L.canvas({ padding: 0.5 /*, pane: 'overlayPane'*/ });\r\n});\r\nL.Map.include({\r\n\tgetRenderer: function(layer) {\r\n\t\tif (layer && layer.options && layer.options.kmzRenderer) {\r\n\t\t\tif (layer.options.kmzRenderer instanceof L.Renderer)\r\n\t\t\t\tlayer.options.renderer = layer.options.kmzRenderer;\r\n\t\t\telse if (layer.options.kmzRenderer)\r\n\t\t\t\tlayer.options.renderer = this.options.kmzRenderer;\r\n\t\t}\r\n\t\tvar renderer = getRendererMapProto.call(this, layer);\r\n\t\treturn renderer;\r\n\t},\r\n});\r\n\r\nexport var KMZLoader = L.KMZLoader;\r\n","/**\r\n * Optimized leaflet canvas renderer to load numerous markers\r\n *\r\n * @link https://stackoverflow.com/a/51852641\r\n * @link https://stackoverflow.com/a/43019740\r\n *\r\n */\r\nL.KMZMarker = L.CircleMarker.extend({\r\n\tsetIconUrl: function(iconUrl) {\r\n\t\tthis._iconUrl = typeof iconUrl !== \"undefined\" ? iconUrl : this._iconUrl;\r\n\t},\r\n\t_updatePath: function() {\r\n\t\tvar renderer = this._renderer;\r\n\t\tvar layer = this;\r\n\r\n\t\tif (!this._iconUrl || !renderer._drawing || layer._empty()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar p = layer._point,\r\n\t\t\tctx = renderer._ctx;\r\n\r\n\t\tvar icon = new Image(),\r\n\t\t\twidth = 28,\r\n\t\t\theight = 28;\r\n\r\n\t\ticon.onload = function() {\r\n\t\t\tctx.drawImage(icon, p.x - (width / 2.0), p.y - (height / 2.0), width, height);\r\n\t\t\t// Removed in Leaflet 1.4.0\r\n\t\t\tif (renderer._drawnLayers) renderer._drawnLayers[layer._leaflet_id] = layer;\r\n\t\t\telse renderer._layers[layer._leaflet_id] = layer;\r\n\t\t};\r\n\t\ticon.src = this._iconUrl;\r\n\t}\r\n});\r\n\r\nexport var KMZMarker = L.KMZMarker;\r\n","/**\r\n * A plugin combining geojson-vt with leafletjs which is initially inspired by leaflet-geojson-vt.\r\n *\r\n * @author Brandonxiang, Raruto\r\n *\r\n * @link https://github.com/brandonxiang/leaflet-geojson-vt\r\n */\r\n\r\nimport * as _ from './utils';\r\nimport 'leaflet-pointable';\r\n\r\nL.GridLayer.GeoJSON = L.GridLayer.extend({\r\n\toptions: {\r\n\t\tpointable: false,\r\n\t\tballon: false,\r\n\t\tbindPopup: false,\r\n\t\tbindTooltip: false,\r\n\t\tasync: false,\r\n\t\tmaxZoom: 24,\r\n\t\ttolerance: 3,\r\n\t\tdebug: 0,\r\n\t\textent: 4096,\r\n\t\tbuffer: 256,\r\n\t\ticon: {\r\n\t\t\twidth: 28,\r\n\t\t\theight: 28,\r\n\t\t},\r\n\t\tstyles: {\r\n\t\t\tstrokeWidth: 1,\r\n\t\t\tstrokeColor: '#f00',\r\n\t\t\tstrokeOpacity: 1.0,\r\n\t\t\tfillColor: '#000',\r\n\t\t\tfillOpacity: 0.25\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function(geojson, options) {\r\n\t\tL.setOptions(this, options);\r\n\t\tL.GridLayer.prototype.initialize.call(this, options);\r\n\t\tthis.tileIndex = (geojsonvt || window.geojsonvt)(geojson, this.options);\r\n\t\tthis.geojson = geojson; // eg. saved for advanced \"leaflet-pip\" mouse/click integrations\r\n\t},\r\n\r\n\tonAdd: function(map) {\r\n\t\tL.GridLayer.prototype.onAdd.call(this, map);\r\n\t\tif (this.options.ballon) {\r\n\t\t\tif (this.options.bindPopup) this._map.on(\"click\", this.updateBalloon, this);\r\n\t\t\tif (this.options.bindTooltip) this._map.on(\"mousemove\", this.updateBalloon, this);\r\n\t\t}\r\n\t},\r\n\r\n\tcreateTile: function(coords) {\r\n\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\tvar size = this.getTileSize();\r\n\t\ttile.width = size.x;\r\n\t\ttile.height = size.y;\r\n\t\tvar ctx = tile.getContext('2d');\r\n\r\n\t\t// return the tile so it can be rendered on screen\r\n\t\tvar tileInfo = this.tileIndex.getTile(coords.z, coords.x, coords.y);\r\n\t\tvar features = tileInfo ? tileInfo.features : [];\r\n\t\tfor (var i = 0; i < features.length; i++) {\r\n\t\t\tthis._drawFeature(ctx, features[i]);\r\n\t\t}\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_drawFeature: function(ctx, feature) {\r\n\t\tctx.beginPath();\r\n\t\tthis._setStyle(ctx, feature);\r\n\t\tif (feature.type === 1) this._drawIcon(ctx, feature);\r\n\t\telse if (feature.type === 2) this._drawLine(ctx, feature);\r\n\t\telse if (feature.type === 3) this._drawPolygon(ctx, feature);\r\n\t\telse console.warn('Unsupported feature type: ' + feature.geometry.type, feature);\r\n\r\n\t\tctx.stroke();\r\n\t},\r\n\r\n\t_drawIcon: function(ctx, feature) {\r\n\t\tvar icon = new Image(),\r\n\t\t\tp = feature.geometry[0],\r\n\t\t\twidth = this.options.icon.width,\r\n\t\t\theight = this.options.icon.height;\r\n\t\ticon.onload = () => ctx.drawImage(icon, (p[0] / 16.0) - (width / 2.0), (p[1] / 16.0) - (height / 2.0), width, height);\r\n\t\ticon.src = feature.tags.icon ? feature.tags.icon : null;\r\n\t},\r\n\r\n\t_drawLine: function(ctx, feature) {\r\n\t\tvar line = feature.geometry,\r\n\t\t\tring, p, j, k;\r\n\t\tfor (j = 0; j < line.length; j++) {\r\n\t\t\tring = line[j];\r\n\t\t\tfor (k = 0; k < ring.length; k++) {\r\n\t\t\t\tp = ring[k];\r\n\t\t\t\tif (k) ctx.lineTo(p[0] / 16.0, p[1] / 16.0);\r\n\t\t\t\telse ctx.moveTo(p[0] / 16.0, p[1] / 16.0);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_drawPolygon: function(ctx, feature) {\r\n\t\tthis._drawLine(ctx, feature);\r\n\t\tctx.fill('evenodd');\r\n\t},\r\n\r\n\t_setStyle: function(ctx, feature) {\r\n\t\tvar style = {};\r\n\r\n\t\tif (feature.type === 1) style = this._setPointStyle(feature, style);\r\n\t\telse if (feature.type === 2) style = this._setLineStyle(feature, style);\r\n\t\telse if (feature.type === 3) style = this._setPolygonStyle(feature, style);\r\n\r\n\t\tctx.lineWidth = style.stroke ? this._setWeight(style.weight) : 0;\r\n\t\tctx.strokeStyle = style.stroke ? this._setOpacity(style.stroke, style.opacity) : {};\r\n\t\tctx.fillStyle = style.fill ? this._setOpacity(style.fill, style.fillOpacity) : {};\r\n\t},\r\n\r\n\t_setPointStyle: function(feature, style) {\r\n\t\treturn style;\r\n\t},\r\n\r\n\t_setLineStyle: function(feature, style) {\r\n\t\tstyle.weight = (feature.tags[\"stroke-width\"] ? feature.tags[\"stroke-width\"] : this.options.styles.strokeWidth) * 1.05;\r\n\t\tstyle.opacity = feature.tags[\"stroke-opacity\"] ? feature.tags[\"stroke-opacity\"] : this.options.styles.strokeOpacity;\r\n\t\tstyle.stroke = feature.tags.stroke ? feature.tags.stroke : this.options.styles.strokeColor;\r\n\t\treturn style;\r\n\t},\r\n\r\n\t_setPolygonStyle: function(feature, style) {\r\n\t\tstyle = this._setLineStyle(feature, style);\r\n\t\tstyle.fill = feature.tags.fill ? feature.tags.fill : this.options.styles.fillColor;\r\n\t\tstyle.fillOpacity = feature.tags[\"fill-opacity\"] ? feature.tags[\"fill-opacity\"] : this.options.styles.fillOpacity;\r\n\t\treturn style;\r\n\t},\r\n\r\n\t_setWeight: function(weight) {\r\n\t\treturn weight || 5;\r\n\t},\r\n\r\n\t_setOpacity: function(color, opacity) {\r\n\t\treturn _.toRGBA(color || '#f00', opacity);\r\n\t},\r\n\r\n\t/**\r\n\t * (EXPERIMENTAL) Based on: https://github.com/Raruto/leaflet-pointable\r\n\t */\r\n\tupdateBalloon: function(e) {\r\n\t\tif (!this._map || !this.options.pointable || !this._map.isPointablePixel() || !this.isPointablePixel()) return;\r\n\t\tthis._popup = this._popup || L.popup();\r\n\t\tvar points = _.pointInLayer(e.latlng, this.geojson);\r\n\t\tif (points) {\r\n\t\t\tvar feature = points[0];\r\n\t\t\tvar name = feature.properties.name || \"\";\r\n\t\t\tif (name) {\r\n\t\t\t\tthis._popup.setLatLng(e.latlng);\r\n\t\t\t\tthis._popup.setContent('<b>' + name + '</b>');\r\n\t\t\t\tthis._popup.openOn(this._map);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._map.closePopup(this._popup);\r\n\t\t}\r\n\t},\r\n\r\n});\r\n\r\nL.gridLayer.geoJson = function(geojson, options) {\r\n\treturn new L.GridLayer.GeoJSON(geojson, options);\r\n};\r\n\r\nexport var GridLayer = {\r\n\tGeoJSON: L.GridLayer.GeoJSON,\r\n};\r\n\r\nexport var gridLayer = {\r\n\tgeoJSON: L.gridLayer.geoJson,\r\n};\r\n"],"names":["getBinaryContent","path","callback","xhr","window","XMLHttpRequest","open","setRequestHeader","responseType","onreadystatechange","evt","file","err","readyState","status","response","responseText","e","Error","this","statusText","send","getKmlDoc","files","getKmlFiles","Object","keys","filter","test","getImageFiles","getLatLngs","feature","i","coords","o","geometry","type","coordinates","length","getLatLngsPoint","push","j","getLatLngsPoly","polys","geometries","console","warn","listToObject","list","reduce","obj","item","parseKMZFolder","zip","Promise","resolve","reject","all","map","name","entry","async","then","value","mapZipFiles","readFile","mapListFiles","data","kmzFiles","kmlDoc","images","kmlString","imageUrl","dataUrl","replaceAll","decodeKMZFolder","pointInPolygon","point","vs","x","y","inside","xi","yi","xj","yj","filename","fileblob","ext","split","pop","toLowerCase","replace","getFileExt","blob","mime","fr","FileReader","onload","result","indexOf","base64","readAsDataURL","readAsText","fileReader","getMimeType","str","find","RegExp","escapeRegExp","toRGBA","color","alpha","iscolorHex","colorRgb","sColor","sColorNew","slice","concat","sColorChange","parseInt","extractRGB","L","KMZParser","Class","extend","initialize","opts","setOptions","loaders","load","kmzUrl","_loadAsyncJS","_requiredJSModules","_waitAsyncJS","_loadKMZ","bind","get","kmzLoader","KMZLoader","options","parse","urls","_jsPromise","promises","url","tag","document","createElement","src","onerror","head","appendChild","_.loadJS","_jsPromisePending","host","JSZip","toGeoJSON","geojsonvt","call","renderer","tiled","interactive","ballon","bindPopup","bindTooltip","debug","keepFront","emptyIcon","pointable","onKMZLoaded","_load","_.getBinaryContent","error","_parse","P","Uint8Array","K","String","fromCharCode","_parseKMZ","_parseKML","loadAsync","_.unzip","kml","text","ArrayBuffer","apply","_.decodeKMLString","xmlDoc","DOMParser","parseFromString","_kmlToLayer","_keepFront","layer","bringToFront","on","_map","off","_.toGeoJSON","geojson","geoJson","pointToLayer","_pointToLayer","onEachFeature","_onEachFeature","kmzRenderer","gridlayer","gridLayer","featureGroup","_onKMZLoaded","latlng","KMZMarker","_setLayerPointIcon","_setLayerStyle","_setLayerBalloon","log","setIconUrl","properties","icon","styles","weight","opacity","fillOpacity","stroke","fill","fillColor","setStyle","desc","description","direction","sticky","getRendererMapProto","Map","prototype","getRenderer","addInitHook","canvas","padding","include","Renderer","CircleMarker","iconUrl","_iconUrl","_updatePath","_renderer","_drawing","_empty","p","_point","ctx","_ctx","Image","drawImage","_drawnLayers","_leaflet_id","_layers","GridLayer","GeoJSON","maxZoom","tolerance","extent","buffer","width","height","strokeWidth","strokeColor","strokeOpacity","tileIndex","onAdd","updateBalloon","createTile","tile","DomUtil","create","size","getTileSize","getContext","tileInfo","getTile","z","features","_drawFeature","beginPath","_setStyle","_drawIcon","_drawLine","_drawPolygon","tags","ring","k","line","lineTo","moveTo","style","_setPointStyle","_setLineStyle","_setPolygonStyle","lineWidth","_setWeight","strokeStyle","_setOpacity","fillStyle","_.toRGBA","isPointablePixel","_popup","popup","points","first","LatLng","lng","lat","results","_.pointInLayer","setLatLng","setContent","openOn","closePopup","geoJSON"],"mappings":"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"}